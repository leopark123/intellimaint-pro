---
name: fix
description: 引导完成 Bug 修复流程，从问题定位到修复验证
---

# Bug 修复任务

请按照以下步骤完成 Bug 修复：

## 1. 问题收集

询问用户 Bug 详情：
- Bug 描述是什么？
- 复现步骤是什么？
- 期望行为 vs 实际行为？
- 有错误日志吗？

## 2. 问题分析

### 定位问题模块
根据 Bug 描述判断涉及的模块：
- 后端 API？
- 前端 UI？
- 数据库？
- 实时通信？
- 认证授权？

### 复现问题
如果可能，尝试在代码层面理解问题：
1. 查看相关代码
2. 分析数据流
3. 检查边界条件

## 3. 根因分析

使用 5 Why 方法深入分析：

```markdown
## 根因分析

### 现象
[Bug 表现]

### 直接原因
[导致 Bug 的直接代码问题]

### 根本原因
[为什么会写出这样的代码]

### 影响范围
[还有哪些地方可能有类似问题]
```

## 4. 修复方案

提出修复方案：

```markdown
## 修复方案

### 方案描述
[如何修复]

### 修改文件
- `src/xxx.cs` - [修改说明]

### 风险评估
- 影响范围: [大/中/小]
- 回归风险: [高/中/低]
```

## 5. 实施修复

### 修改代码
根据方案修改代码，确保：
- 修复 Bug 本身
- 不引入新问题
- 代码风格一致

### 添加测试
使用 `testing-expert`：
- 添加覆盖此 Bug 的测试用例
- 确保测试能捕获回归

## 6. 验证修复

```bash
# 运行相关测试
dotnet test --filter "ClassName~RelatedTests"

# 运行所有测试确保无回归
dotnet test
```

## 7. 代码审查

使用 `code-reviewer` 审查修复：
- 修复是否正确？
- 是否引入新问题？
- 测试是否充分？

## 8. 完成报告

```markdown
# Bug 修复报告

## Bug 信息
- **描述**: [Bug 描述]
- **严重程度**: Critical/High/Medium/Low
- **影响范围**: [受影响的功能]

## 根因
[根本原因分析]

## 修复内容
- `src/xxx.cs:行号` - [修改说明]

## 测试
- 添加测试: [测试名称]
- 所有测试通过: ✅

## 防止复发
[建议的预防措施]
```

---

**修复原则**：
1. 先理解问题再修复
2. 修复根因而非表象
3. 必须添加回归测试
4. 检查类似问题
