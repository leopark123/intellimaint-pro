---
name: refactor
description: 执行代码重构，改善代码结构而不改变功能
---

# 重构任务

请按照以下步骤执行代码重构：

## 1. 重构范围确定

询问用户重构范围：
- 特定文件/类/方法
- 特定模块
- 全局重构（某种模式）

## 2. 重构前准备

### 确保测试覆盖
```bash
# 运行测试确保现有功能正常
dotnet test
```

⚠️ **重要**: 如果没有足够的测试覆盖，先添加测试再重构！

### 记录当前状态
- 记录要重构的代码
- 记录期望的改进

## 3. 识别重构模式

使用 `code-reviewer` 识别适用的重构：

### 方法级重构
- **提取方法** - 长方法拆分
- **内联方法** - 过度拆分合并
- **重命名** - 改善命名
- **引入参数对象** - 过多参数
- **移除死代码** - 未使用的代码

### 类级重构
- **提取类** - 职责过多
- **内联类** - 类过小
- **移动方法** - 方法放错位置
- **提取接口** - 抽象依赖

### 架构级重构
- **分层重构** - 违反分层
- **依赖倒置** - 依赖具体类
- **引入工厂** - 创建逻辑复杂

## 4. 制定重构计划

```markdown
## 重构计划

### 目标
[重构目标，期望改进什么]

### 步骤
1. [具体重构步骤 1]
2. [具体重构步骤 2]
3. ...

### 风险
- [可能的风险]

### 验证方式
- [如何验证重构成功]
```

## 5. 执行重构

### 小步重构
每次只做一个小的重构：
1. 执行重构
2. 运行测试
3. 确认通过
4. 继续下一步

### 保持功能不变
- 不添加新功能
- 不修复 Bug（除非与重构相关）
- 只改善结构

## 6. 重构后验证

```bash
# 运行所有测试
dotnet test

# 检查是否有编译警告
dotnet build --warnaserror
```

## 7. 代码审查

使用 `code-reviewer` 审查重构结果：
- 是否改善了代码质量？
- 是否引入了新问题？
- 是否符合设计原则？

## 8. 完成报告

```markdown
# 重构报告

## 重构概述
- **范围**: [重构的代码范围]
- **类型**: [方法级/类级/架构级]

## 重构前
\`\`\`csharp
// 原代码
\`\`\`

## 重构后
\`\`\`csharp
// 新代码
\`\`\`

## 改进点
- ✅ [改进 1]
- ✅ [改进 2]

## 验证
- 所有测试通过: ✅
- 无编译警告: ✅

## 变更文件
- `src/xxx.cs` - [变更说明]
```

---

**重构原则**：
1. 有测试才重构
2. 小步快跑
3. 每步都能回退
4. 不混入功能变更
5. 重构是投资，不是债务

**常用快捷选项**：
- `/refactor extract-method` - 提取方法重构
- `/refactor rename` - 重命名重构
- `/refactor cleanup` - 清理死代码
