---
name: feature
description: 引导完成一个完整功能的开发，从需求分析到代码实现到测试
---

# 功能开发任务

请按照以下步骤完成功能开发：

## 1. 需求理解

首先，询问用户要开发的功能：
- 功能描述是什么？
- 有哪些具体需求？
- 有什么约束或限制？

## 2. 架构评估

使用 `architect` 的视角评估：

### 影响范围分析
- 需要修改哪些模块？
- 是否需要新增表/接口？
- 对现有功能有何影响？

### 技术方案
- 推荐的实现方式
- 需要的技术组件
- 潜在的技术风险

## 3. 任务分解

将功能分解为可执行的子任务：

```markdown
## 功能: [功能名称]

### 后端任务
- [ ] 数据模型设计
- [ ] API 端点实现
- [ ] 业务逻辑实现
- [ ] 单元测试

### 前端任务
- [ ] 页面/组件设计
- [ ] API 调用集成
- [ ] 状态管理
- [ ] UI 测试

### 其他任务
- [ ] 文档更新
- [ ] 配置更新
```

## 4. 实现阶段

按顺序执行任务：

### 4.1 数据层
使用 `database-expert`：
- 设计表结构
- 创建/修改 Schema
- 实现仓储方法

### 4.2 后端 API
使用 `backend-expert`：
- 创建 DTO
- 实现端点
- 添加业务逻辑
- 配置路由和权限

### 4.3 前端 UI
使用 `frontend-expert`：
- 创建页面/组件
- 实现交互逻辑
- 集成 API
- 添加到路由

### 4.4 测试
使用 `testing-expert`：
- 编写单元测试
- 编写集成测试
- 验证功能正确性

## 5. 代码审查

使用 `code-reviewer` 审查所有变更：
- 正确性
- 安全性
- 性能
- 可维护性

## 6. 文档更新

使用 `docs-expert`：
- 更新 API 文档
- 更新 CHANGELOG
- 更新用户指南（如需要）

## 7. 完成报告

```markdown
# 功能开发报告

## 功能概述
[功能描述]

## 变更文件
- `src/xxx` - [变更说明]
- `src/xxx` - [变更说明]

## 新增 API
| 端点 | 方法 | 说明 |
|------|------|------|
| /api/xxx | GET | xxx |

## 测试覆盖
- 单元测试: X 个
- 集成测试: X 个

## 使用说明
[如何使用这个功能]
```

---

**开发原则**：
1. 先理解再动手
2. 保持小步提交
3. 每步都要测试
4. 代码质量优先

## ⚠️ 质量门禁 (必须满足)

功能开发必须通过以下质量门禁才能视为完成：

### 阶段 1: 需求确认
- [ ] **需求明确** - 功能描述清晰，无歧义
- [ ] **边界定义** - 明确功能范围和不做的内容
- [ ] **验收标准** - 用户确认验收条件

### 阶段 2: 设计验证
- [ ] **架构评审** - 影响范围已分析
- [ ] **技术方案** - 实现方式已确定
- [ ] **接口设计** - API 契约已定义

### 阶段 3: 实现验证
- [ ] **数据层** - Schema/Repository 已实现并测试
- [ ] **业务层** - Service 逻辑已实现并测试
- [ ] **API 层** - Endpoint 已实现并测试
- [ ] **前端** - UI 组件已实现并测试

### 阶段 4: 测试验证
- [ ] **单元测试** - 关键逻辑覆盖 > 80%
- [ ] **集成测试** - API 端点 100% 覆盖
- [ ] **手动测试** - 主流程验证通过
- [ ] **边界测试** - 异常场景已覆盖

### 阶段 5: 验收确认
- [ ] **代码审查** - 无 Critical/Warning 问题
- [ ] **功能验收** - 用户确认功能符合预期
- [ ] **文档更新** - API 文档/CHANGELOG 已更新

### ❌ 不合格示例
```markdown
功能开发完成:
- 已完成登录功能    ← 没有测试证据
- 应该能正常使用    ← 没有验收确认
```

### ✅ 合格示例
```markdown
# 功能开发报告: 用户登录

## 阶段完成情况

### 1. 需求确认 ✅
- 功能: 用户名/密码登录，返回 JWT Token
- 边界: 不含社交登录、忘记密码
- 验收: 登录成功返回 Token，失败返回 401

### 2. 设计验证 ✅
- 影响模块: AuthEndpoints, UserRepository
- 技术方案: JWT + BCrypt 密码哈希
- API: POST /api/auth/login

### 3. 实现验证 ✅
- [x] UserRepository.GetByUsernameAsync - 已实现
- [x] AuthEndpoints.Login - 已实现
- [x] LoginPage 组件 - 已实现

### 4. 测试验证 ✅
| 测试类型 | 数量 | 通过 |
|----------|------|------|
| 单元测试 | 5 | 5/5 |
| 集成测试 | 3 | 3/3 |
| 手动测试 | 2 | 2/2 |

测试用例:
- ✅ 正确密码登录成功
- ✅ 错误密码返回 401
- ✅ 用户不存在返回 401
- ✅ Token 格式正确

### 5. 验收确认 ✅
- 代码审查: 无问题
- 用户验收: 确认通过
- 文档: API.md 已更新
```
