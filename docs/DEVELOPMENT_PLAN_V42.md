# IntelliMaint Pro 全面审查与开发计划

**审查日期**: 2025-12-30  
**当前版本**: v42  
**目标版本**: v1.0.0 (生产就绪)

---

## 一、项目状态总览

### 1.1 架构完成度

```
┌─────────────────────────────────────────────────────────────────┐
│                    IntelliMaint Pro 架构                         │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐         │
│  │   React UI  │◄──►│  Host.Api   │◄──►│  Host.Edge  │         │
│  │  (端口3000) │    │  (端口5000) │    │  (采集服务)  │         │
│  └─────────────┘    └─────────────┘    └─────────────┘         │
│        │                  │                   │                 │
│        │            ┌─────┴─────┐             │                 │
│        │            │           │             │                 │
│        ▼            ▼           ▼             ▼                 │
│  ┌──────────┐  ┌─────────┐  ┌────────┐  ┌──────────┐           │
│  │ SignalR  │  │ SQLite  │  │Pipeline│  │ OPC UA   │           │
│  │ 实时推送  │  │ 数据库   │  │数据流   │  │LibPlcTag │           │
│  └──────────┘  └─────────┘  └────────┘  └──────────┘           │
│                                                                 │
│  状态: ✅ 基础架构完成                                           │
└─────────────────────────────────────────────────────────────────┘
```

### 1.2 功能模块完成度

| 模块 | 完成度 | 版本 | 状态 |
|------|--------|------|------|
| **数据采集层** |
| OPC UA 采集器 | 100% | v12 | ✅ 生产可用 |
| LibPlcTag 采集器 | 100% | v5 | ✅ 生产可用 |
| Pipeline 数据流 | 100% | v14 | ✅ 生产可用 |
| **API 层** |
| 认证授权 (JWT + RBAC) | 100% | v38 | ✅ 完成 |
| Token 刷新机制 | 100% | v39 | ✅ 完成 |
| 遥测数据 API | 100% | v41 | ✅ 完成 |
| 设备管理 API | 100% | v23 | ✅ 完成 |
| 标签管理 API | 100% | v24 | ✅ 完成 |
| 告警管理 API | 100% | v25 | ✅ 完成 |
| 告警规则 API | 100% | v30 | ✅ 完成 |
| 健康监控 API | 100% | v26 | ✅ 完成 |
| 数据导出 API | 100% | v27 | ✅ 完成 |
| 系统设置 API | 100% | v28 | ✅ 完成 |
| 用户管理 API | 100% | v40 | ✅ 完成 |
| 审计日志 API | 100% | v37 | ✅ 完成 |
| SignalR 实时推送 | 100% | v22 | ✅ 完成 |
| **前端 UI** |
| 登录页面 | 100% | v35 | ✅ 完成 |
| 实时监控 Dashboard | 90% | v42 | ⚠️ 健康指数为模拟 |
| 设备管理页面 | 100% | v29 | ✅ 完成 |
| 标签管理页面 | 100% | v30 | ✅ 完成 |
| 数据查询页面 | 100% | v21 | ✅ 完成 |
| 告警管理页面 | 100% | v31 | ✅ 完成 |
| 告警规则页面 | 100% | v31 | ✅ 完成 |
| 系统设置页面 | 100% | v32 | ✅ 完成 |
| 系统健康页面 | 100% | v32 | ✅ 完成 |
| 用户管理页面 | 100% | v40 | ✅ 完成 |
| 审计日志页面 | 100% | v37 | ✅ 完成 |
| **核心算法** |
| 阈值告警引擎 | 100% | v30 | ✅ 完成 |
| 健康指数计算 | 0% | - | ❌ 未实现 |
| 故障预测模型 | 0% | - | ❌ 未实现 |
| 趋势分析 | 0% | - | ❌ 未实现 |

### 1.3 代码质量评估

| 指标 | 评分 | 说明 |
|------|------|------|
| 架构设计 | ⭐⭐⭐⭐ | Clean Architecture，分层清晰 |
| 代码规范 | ⭐⭐⭐⭐ | 命名规范，结构一致 |
| 错误处理 | ⭐⭐⭐ | 基本完整，部分需加强 |
| 类型安全 | ⭐⭐⭐⭐ | TypeScript 严格模式 |
| 安全性 | ⭐⭐⭐ | JWT/RBAC 完成，需加固 |
| 测试覆盖 | ⭐⭐ | 集成测试框架存在，覆盖率低 |
| 文档完整度 | ⭐⭐⭐⭐ | 文档齐全 |

---

## 二、技术债务清单

### 🔴 高优先级（必须修复）

| # | 问题 | 位置 | 影响 | 预计工时 |
|---|------|------|------|----------|
| 1 | SignalR Hub 无授权 | `TelemetryHub.cs` | 安全风险 | 0.5h |
| 2 | JWT SecretKey 硬编码 | `appsettings.json` | 安全风险 | 0.5h |
| 3 | 配置修改需重启服务 | `OpcUaCollector` | 运维不便 | 2h |

### 🟠 中优先级（建议修复）

| # | 问题 | 位置 | 影响 | 预计工时 |
|---|------|------|------|----------|
| 4 | Dashboard 健康指数为模拟 | `Dashboard/index.tsx` | 功能缺失 | 4h |
| 5 | 缺少 ESLint 配置 | 前端项目 | 代码质量 | 1h |
| 6 | 缺少单元测试 | 全项目 | 质量保障 | 8h+ |
| 7 | 数据库无连接池配置 | SQLite | 性能 | 1h |

### 🟡 低优先级（可选优化）

| # | 问题 | 位置 | 影响 | 预计工时 |
|---|------|------|------|----------|
| 8 | API 错误处理不统一 | 前端 | 用户体验 | 4h |
| 9 | 缺少 API 版本控制 | Host.Api | 兼容性 | 2h |
| 10 | 缺少请求限流 | Host.Api | 安全性 | 2h |

---

## 三、核心功能开发计划

> **产品定位**: 零改造、零传感器，让每台 PLC/变频器变成智能预警终端
> 
> **核心价值**: 提前 72h+ 预警，减少非计划停机 60%+

### Phase 1: 安全加固 (v43-v44)

**目标**: 生产环境安全要求

| Batch | 功能 | 优先级 | 工时 | 交付物 |
|-------|------|--------|------|--------|
| v43 | SignalR 授权 + 密钥外置 | P0 | 2h | 安全配置 |
| v44 | 请求限流 + 审计增强 | P1 | 4h | 安全中间件 |

### Phase 2: 健康评估引擎 (v45-v48) ⭐核心

**目标**: 实现设备健康指数 0-100 量化评估

```
┌─────────────────────────────────────────────────────────────┐
│                    健康评估引擎架构                           │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  遥测数据 ──► 特征提取 ──► 健康模型 ──► 健康指数 (0-100)      │
│                  │            │                             │
│                  ▼            ▼                             │
│             统计特征      基线比较                            │
│             趋势特征      异常检测                            │
│             频域特征      劣化评估                            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

| Batch | 功能 | 说明 | 工时 |
|-------|------|------|------|
| v45 | 特征提取服务 | 滑动窗口统计（均值、方差、趋势斜率） | 8h |
| v46 | 健康基线管理 | 设备学习期 + 基线存储 | 8h |
| v47 | 健康评分算法 | 多维度加权评分 | 8h |
| v48 | Dashboard 集成 | 真实健康指数显示 | 4h |

**健康指数算法示意**:

```csharp
public class HealthScoreCalculator
{
    public double Calculate(DeviceFeatures features, DeviceBaseline baseline)
    {
        var scores = new[]
        {
            // 1. 运行参数偏离度 (权重 40%)
            CalculateDeviationScore(features, baseline) * 0.4,
            
            // 2. 趋势健康度 (权重 30%)
            CalculateTrendScore(features) * 0.3,
            
            // 3. 波动稳定性 (权重 20%)
            CalculateStabilityScore(features, baseline) * 0.2,
            
            // 4. 告警历史 (权重 10%)
            CalculateAlarmScore(features) * 0.1
        };
        
        return Math.Round(scores.Sum(), 1);  // 0-100
    }
}
```

### Phase 3: 故障预测引擎 (v49-v52) ⭐核心

**目标**: 提前 72h+ 故障预警

| Batch | 功能 | 说明 | 工时 |
|-------|------|------|------|
| v49 | 趋势预测服务 | 线性回归 + 指数平滑 | 8h |
| v50 | 劣化检测 | 渐变异常识别 | 8h |
| v51 | 预警生成器 | 预测告警 + 置信度 | 6h |
| v52 | 预警 Dashboard | 预测趋势可视化 | 6h |

**预测模型**:

```
┌─────────────────────────────────────────────────────────────┐
│                    故障预测流程                              │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  历史数据 ──► 趋势建模 ──► 外推预测 ──► 阈值比较 ──► 预警     │
│                                                             │
│  示例:                                                       │
│  - 当前温度: 75°C (健康)                                     │
│  - 趋势斜率: +0.5°C/天                                       │
│  - 预测: 14天后达到 82°C (警告阈值)                          │
│  - 输出: "预计 14 天后温度超标，建议检查散热"                 │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### Phase 4: 维护建议系统 (v53-v55)

**目标**: 数据驱动的维护建议

| Batch | 功能 | 说明 | 工时 |
|-------|------|------|------|
| v53 | 知识库设计 | 故障-原因-措施映射 | 6h |
| v54 | 建议生成引擎 | 基于规则的建议 | 8h |
| v55 | 建议 UI | 维护建议展示 | 4h |

### Phase 5: 生产就绪 (v56-v60)

| Batch | 功能 | 说明 | 工时 |
|-------|------|------|------|
| v56 | Docker 部署 | Dockerfile + docker-compose | 4h |
| v57 | 性能优化 | 数据库索引 + 查询优化 | 8h |
| v58 | 监控告警 | Prometheus + Grafana 集成 | 6h |
| v59 | 文档完善 | 部署文档 + API 文档 | 4h |
| v60 | v1.0.0 发布 | 版本打标 + Release Notes | 2h |

---

## 四、里程碑计划

```
2025-01
├── Week 1: v43-v44 安全加固 ──────────────────► MVP 安全版
├── Week 2: v45-v48 健康评估引擎 ─────────────► 健康指数上线
├── Week 3: v49-v52 故障预测引擎 ─────────────► 预测功能上线
└── Week 4: v53-v60 生产就绪 ─────────────────► v1.0.0 发布
```

| 里程碑 | 版本 | 目标日期 | 核心交付 |
|--------|------|----------|----------|
| M1: 安全加固 | v44 | +2天 | 生产级安全 |
| M2: 健康评估 | v48 | +7天 | 真实健康指数 |
| M3: 故障预测 | v52 | +14天 | 72h+ 预警能力 |
| M4: 生产就绪 | v60 | +21天 | v1.0.0 发布 |

---

## 五、技术选型建议

### 5.1 预测算法

| 方案 | 优点 | 缺点 | 推荐度 |
|------|------|------|--------|
| **线性回归** | 简单、可解释 | 只能捕捉线性趋势 | ⭐⭐⭐⭐ MVP 首选 |
| 指数平滑 | 适合时序数据 | 参数调优复杂 | ⭐⭐⭐ |
| LSTM | 强大的序列建模 | 需要大量数据、黑箱 | ⭐⭐ 后期可选 |
| 孤立森林 | 异常检测效果好 | 不适合趋势预测 | ⭐⭐⭐ 辅助使用 |

### 5.2 数据存储演进

```
当前: SQLite (MVP)
  │
  ▼ 数据量 > 100GB
  │
TimescaleDB (推荐)
  - 时序数据优化
  - 自动分区
  - 压缩存储
  - 兼容 PostgreSQL
```

---

## 六、立即行动项

### 本周优先（v43-v44）

```bash
# 1. SignalR 授权修复
# 在 TelemetryHub.cs 添加
[Authorize]
public sealed class TelemetryHub : Hub

# 2. JWT 密钥外置
# appsettings.json
"Jwt": {
  "SecretKey": "${JWT_SECRET_KEY}"  // 从环境变量读取
}

# 3. Program.cs 配置
builder.Configuration.AddEnvironmentVariables();
```

### 下周优先（v45-v46）

开始健康评估引擎开发：

1. 创建 `src/Application/Services/FeatureExtractor.cs`
2. 创建 `src/Application/Services/HealthScoreCalculator.cs`  
3. 创建 `health_baseline` 数据库表
4. 集成到 Dashboard

---

## 七、风险与应对

| 风险 | 可能性 | 影响 | 应对措施 |
|------|--------|------|----------|
| 预测算法准确度不足 | 中 | 高 | 从简单模型开始，逐步迭代 |
| 性能瓶颈 | 中 | 中 | 提前做性能测试，预留优化时间 |
| 需求变更 | 高 | 中 | 保持架构灵活性，模块化设计 |

---

## 八、下一步

请选择：

**A** - 立即开始 v43 安全加固  
**B** - 直接进入 v45 健康评估引擎开发  
**C** - 先完成单元测试补充  
**D** - 其他优先级

---

*文档版本: 2025-12-30*  
*下次更新: 每周一*
